---
import Header from "./Header.astro";
import Footer from "./Footer.astro";
import BackToTop from "./BackToTop.astro";
import SiteHead from "./SiteHead.astro";
import type { BlogsPageData } from "../data/blogs";
import { blogsPerPage } from "../data/blogs";
import "../styles/landing.css";
import "../styles/projects.css";
import "../styles/blogs.css";

export interface PaginationLink {
  pageNumber: number;
  href: string;
  isActive: boolean;
}

export interface Props {
  pageData: BlogsPageData;
  paginationLinks: PaginationLink[];
  firstHref: string;
  prevHref: string;
  nextHref: string;
  lastHref: string;
  isFirstPage: boolean;
  isLastPage: boolean;
}

const {
  pageData,
  paginationLinks,
  firstHref,
  prevHref,
  nextHref,
  lastHref,
  isFirstPage,
  isLastPage,
} = Astro.props;

const placeholderCount = Math.max(
  0,
  blogsPerPage - pageData.blogs.length
);
---

<html lang="en">
  <head>
    <SiteHead title="blogs | davenarchives" />
  </head>
  <body>
    <div class="page blogs-page">
      <Header active="blogs" />
      <main class="blogs-content">
        <header class="blogs-header">
          <h1>BLOGS</h1>
          <p>whatever pops into my head</p>
        </header>
        {
          pageData.blogs.length === 0 ? (
            <section class="blogs-empty-state" aria-live="polite">
              <p>More reflections are brewing. Check back soon.</p>
            </section>
          ) : (
            <section class="projects-grid blogs-grid" aria-label="Blog entries">
              {pageData.blogs.map((post) => {
                const imageMeta = post.image;
                return (
                  <article
                    class="project-card project-card--featured blog-card"
                    aria-labelledby={`${post.slug}-title`}
                  >
                    <a
                      class="project-card__link"
                      href={post.url}
                      aria-label={`Read ${post.title}`}
                    >
                      <div class="project-card__media blog-card__media" role="presentation">
                        <img
                          src={imageMeta.src}
                          width={imageMeta.width}
                          height={imageMeta.height}
                          alt={post.coverAlt}
                          loading="lazy"
                        />
                      </div>
                      <div class="project-card__body blog-card__body">
                        <h2 id={`${post.slug}-title`}>{post.title}</h2>
                        <p class="blog-card__description">
                          {post.description}
                        </p>
                        <ul class="project-card__tags blog-card__tags" aria-label="Tags">
                          {post.tags.map((tag) => (
                            <li>
                              <span>#{tag}</span>
                            </li>
                          ))}
                        </ul>
                      </div>
                    </a>
                  </article>
                );
              })}
              {Array.from({ length: placeholderCount }).map((_, index) => (
                <article
                  class="project-card project-card--placeholder blog-card blog-card--placeholder"
                  aria-label={`Blog placeholder ${index + 1}`}
                >
                  <div class="project-card__placeholder">
                    <span>coming soon</span>
                  </div>
                </article>
              ))}
            </section>
          )
        }
        <nav class="projects-pagination blogs-pagination" aria-label="Blogs pages">
          <ul>
            <li>
              <a
                class={`projects-pagination__link projects-pagination__link--icon${
                  isFirstPage ? " projects-pagination__link--disabled" : ""
                }`}
                href={firstHref}
                aria-label="First page"
                aria-disabled={isFirstPage ? "true" : undefined}
                tabindex={isFirstPage ? "-1" : undefined}
              >
                &laquo;&laquo;
              </a>
            </li>
            <li>
              <a
                class={`projects-pagination__link projects-pagination__link--icon${
                  isFirstPage ? " projects-pagination__link--disabled" : ""
                }`}
                href={prevHref}
                aria-label="Previous page"
                aria-disabled={isFirstPage ? "true" : undefined}
                tabindex={isFirstPage ? "-1" : undefined}
              >
                &laquo;
              </a>
            </li>
            {paginationLinks.map((link) => (
              <li>
                <a
                  class={`projects-pagination__link${
                    link.isActive ? " projects-pagination__link--active" : ""
                  }`}
                  href={link.href}
                  aria-current={link.isActive ? "page" : undefined}
                >
                  {link.pageNumber}
                </a>
              </li>
            ))}
            <li>
              <a
                class={`projects-pagination__link projects-pagination__link--icon${
                  isLastPage ? " projects-pagination__link--disabled" : ""
                }`}
                href={nextHref}
                aria-label="Next page"
                aria-disabled={isLastPage ? "true" : undefined}
                tabindex={isLastPage ? "-1" : undefined}
              >
                &raquo;
              </a>
            </li>
            <li>
              <a
                class={`projects-pagination__link projects-pagination__link--icon${
                  isLastPage ? " projects-pagination__link--disabled" : ""
                }`}
                href={lastHref}
                aria-label="Last page"
                aria-disabled={isLastPage ? "true" : undefined}
                tabindex={isLastPage ? "-1" : undefined}
              >
                &raquo;&raquo;
              </a>
            </li>
          </ul>
        </nav>
      </main>
      <Footer />
      <BackToTop />
    </div>
  </body>
</html>
