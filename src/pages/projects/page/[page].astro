---
import ProjectsPageLayout from "../../../components/ProjectsPageLayout.astro";
import {
  getProjectsPage,
  pageNumbers,
} from "../../../data/projects";

export function getStaticPaths() {
  return pageNumbers.map((pageNumber) => ({
    params: { page: pageNumber.toString() },
  }));
}

const baseProjectsPath = "/projects";
const buildPageHref = (pageNumber: number) =>
  pageNumber <= 1
    ? baseProjectsPath
    : `${baseProjectsPath}/page/${pageNumber}`;

const requestedPageParam = Astro.params.page ?? "1";
const requestedPage = Number.parseInt(requestedPageParam, 10);
const pageData = getProjectsPage(requestedPage);

if (!Number.isFinite(requestedPage) || requestedPage < 1) {
  return Astro.redirect(buildPageHref(pageData.currentPage));
}

if (pageData.currentPage !== requestedPage) {
  return Astro.redirect(buildPageHref(pageData.currentPage));
}

const paginationLinks = pageData.pageNumbers.map((pageNumber) => ({
  pageNumber,
  href: buildPageHref(pageNumber),
  isActive: pageNumber === pageData.currentPage,
}));

const isFirstPage = pageData.currentPage === 1;
const isLastPage = pageData.currentPage === pageData.totalPages;
const firstHref = buildPageHref(1);
const prevHref = buildPageHref(
  Math.max(1, pageData.currentPage - 1)
);
const nextHref = buildPageHref(
  Math.min(pageData.totalPages, pageData.currentPage + 1)
);
const lastHref = buildPageHref(pageData.totalPages);
---

<ProjectsPageLayout
  pageData={pageData}
  paginationLinks={paginationLinks}
  firstHref={firstHref}
  prevHref={prevHref}
  nextHref={nextHref}
  lastHref={lastHref}
  isFirstPage={isFirstPage}
  isLastPage={isLastPage}
/>
